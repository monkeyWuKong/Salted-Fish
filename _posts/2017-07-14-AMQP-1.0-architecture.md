## [Architecture](http://www.amqp.org/product/architecture)

AMQP 1.0 可以使clients 和 servers 通过消息无缝交互，而不必关心他们的技术实现。

它包含了一个高效的有线协议，将网络传输层(network transport)从代理架构（broker architectures）和管理（management）分开。

AMQP 1.0支持多种代理架构， 可以用来receive，排队（queue），路由（route），转发消息（deliver messages）， 或者用于对等网络([P2P: peer-to-peer](http://blog.csdn.net/g_brightboy/article/details/22089653))。

AMQP 1.0 主要指定了三个部分的内容：

* 网络协议(networking protol)
* 消息封装数据的表示(representation for message anvelope data)
* 代理服务的语义(semantics of broker services)


![pic1](http://www.amqp.org/sites/amqp.org/files/styles/large/public/capabilities.png)

### Transport(TCP/IP)

* 可靠的有序字节传输和网络流控制
* 将TCP/IP细分成信道

### Messaging Protocol & Type System

* 消息属性的可移植表示
* 传输节点间的消息传输
* Transfer of Responsibility for Messages between Peers
* 消息流量控制

### Message Broker - the [MOM](http://www.baike.com/wiki/MOM%5B%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E7%9A%84%E9%9B%86%E6%88%90%5D&prd=jinshan) Layer

**消息代理， 面向消息的中间件**

* 消息类应用程序的调解，时间分隔。
* 消息的安全存储
* 事物资源（Transactional Resources）
* 本地地址（Local “Addresses”）
* Message Distribution features; 共享队列, Topics, etc..
* 回复队列（Reply Queues）

### API Mapping

**API映射**

* API之间的概念的规范表示
* Send JMS([Java Message Service](http://baike.baidu.com/link?url=lJPiiYInqe0kR_hWhJkBkaDnIu0J2RSmDJNqDBUju9sGQcKmoH3NE_nzUCqqbuq-sGE59GWa8Lsqv5EgYhCLX_)) <> WCF([Windows Communication Foundation](http://www.baike.com/wiki/wcf)) <> C <> Python …

### Routing between Brokers - in a forthcoming addition

**代理之间的路由--即将加入**

* Political Separation of Messaging Applications
* 消息转发
* Address Forward/Reverse Translation
* 订阅传播Subscription Propagation

### Management –in a forthcoming addition

**管理 -- 即将加入**

* 对任何一个AMQP 代理的标准化管理
* 向代理发送AMQP管理消息以使产生变化
* 利用代理和路由的所有路由和安全特性（利用代理和路由的所有路由和安全特性）

### The AMQP Network Protocol

**AMQP的网络协议**

定义了：

* 端对端的协议（peer to peer protocol）；在AMQP中，一端扮演了一个客户端应用的角色，另一端扮演了一个可信任的消息路由和投递的服务端，或者代理角色。
* How to connect to services, including a method for failing over connections to alternative services
* 可以让端(peer)发现其它端的机制
* 综合安全机制，包括SSL和[Kerberos](http://www.baike.com/wiki/Kerberos)，以实现无缝端到端保密
* 如何复用TCP/IP连接，以便在一个TCP/IP连接上发生多个会话。这大大简化了防火墙管理。
* How to address a source of messages with the network peer, and to specify which messages are of interest
* 一条消息从获取，处理，应答的生命周期。AMQP makes it very clear when responsibility for a message is transferred from one peer to another thereby enhancing reliability
* 如何提高性能。如果需要，可以预先通过网络获取消息以供客户端处理，不会出现延迟。
* 在一个事务中处理批量消息的一种方法。
* A mechanism to allow a complete message transfer from login to logout in one network packet for lightweight applications
* 非常强的流量控制，使消息的使用者能够将生产者放慢到可管理的速度，并使不同的工作负载在一个连接上以不同的速率并行进行。
* 在连接丢失和重新建立时恢复消息传输的机制；例如在服务故障转移或间歇性连接的情况下。

这种低层次的网络协议是全面而有能力的，但对于消息传递软件的用户来说通常是看不见的。像电子邮件一样，用户将消息发送到target@example.com将不知道中间人如何处理请求的细节。

也就是说，网络专家有可能将此协议用于其他目的，但预计到目前为止，该协议最大的用途是将消息类客户端连接到消息类代理；托管了队列和主题的代理负责存储安全，路由，投递。

![pic2](http://www.amqp.org/sites/amqp.org/files/styles/large/public/layering.png)

### Message Representation

AMQP provides portability(可移植性) between systems.  

It therefore needs a way to represent business data that may be required to route and deliver the message in a portable way accessible from many programming languages. 

The AMQP 1.0 Type System and message encoding facilities provide a portable encoding for messages to meet this need.

Normally, this encoding is only used to add routing properties to the “envelope” of the message; the contents inside the envelope are transported untouched.  Applications will likely use XML, JSON or similar encodings in their message content.  Optionally, and application could choose to use AMQP encoding for message content too, but this is entirely optional.

### Broker Services

The value of using message brokers is that a trusted intermediary designed for the purpose handles the complexities of message queuing, routing and delivery.  That intermediary is the message broker.

AMQP defines the minimum set of requirements expected of a message broker, and where there are frequently used more advanced facilities; it specifies how those facilities are to be exposed to clients.

The goal of AMQP is to enable applications to send messages via the broker services; these lower level concepts are necessary but not the goal in themselves.  When you send a message via a courier, you don’t drive the delivery truck yourself!

### AMQP Differentiated

AMQP is different from other middleware standards because it is:

* **INTEROPERABLE**.  ALL AMQP clients interoperate with ALL AMQP servers.  Diverse programming languages can communicate easily.  Legacy message brokers can be retrofitted to remove proprietary protocols from your network.  Messaging can be enabled as a cloud service.  A straight-forward solution for business messaging and middleware integration, made to satisfy real needs.
  
* **RELIABLE**.  Capable of eliminating the communication gaps and slowdowns between different platforms, critical systems and application components both within enterprise and out to external systems and organizations.

* **UNIFIED**.  Provide a core set of messaging patterns via a single manageable protocol.
 
* **COMPLETE**.  JMS provides an API for application protocols, and is reliant on Java. AMQP provides a wire level transport for applications using that API.  AMQP is broadly applicable and can be leveraged by any language, and identifies both store-and-forward and publish-and-subscribe semantics in one specification.  
 
* **OPEN**.  Vendor and platform agnostic, and created by users and technology providers working in collaboration.

* **SAFE**.  A secure solution to the problem of transporting value-bearing messages across and between organizations, technology platforms and a virtual cloud computing environment.

### Use AMQP to Deliver on Service Oriented Architecture (at last!)

**在面向服务的架构中使用AMQP**

![pic3](http://www.amqp.org/sites/amqp.org/files/styles/large/public/different.png)

AMQP completes the picture of an open and pragmatic SOA stack by utilizing a TCP/IP infrastructure for transport that provides ubiquitous connectivity.  The protocol is a trusted intermediary for asynchronous message delivery with specific qualities of service.  XML provides uniform data encoding, while the XML schema provides metadata specification for proper representation.  Expected Message Exchange Patterns are provided by SOAP, while Web Services standards provide for business contract representation. 



